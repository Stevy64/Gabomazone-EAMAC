{% extends 'base.html' %}
{% load static %}

{%block body%}
<!-- ===== Shop Page FLAVORIZ Design ===== -->
<section class="flavoriz-section" style="margin-top: var(--spacing-lg);">
    <!-- Page Header -->
    <div style="max-width: 1400px; margin: 0 auto; padding: 0 var(--spacing-lg); margin-bottom: var(--spacing-xl);">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
            <div>
                <h1 style="font-size: 48px; font-weight: 800; color: var(--color-black); margin-bottom: var(--spacing-sm);">Produits</h1>
                <div style="display: flex; align-items: center; gap: 8px; color: var(--text-gray); font-size: 14px;">
                    <a href="{%url 'home:index'%}" style="color: var(--text-gray); text-decoration: none;">Accueil</a>
                    <span>/</span>
                    <span style="color: var(--color-orange);">Produits</span>
                </div>
            </div>
        </div>
        
        <!-- Product Count & Sort - Design Moderne -->
        <div class="flavoriz-filter-section">
            <div id="product-num" class="flavoriz-filter-count">
                <p style="margin: 0;">Nous avons trouvé <strong>0</strong> articles pour vous !</p>
            </div>
            <div class="flavoriz-filter-sort">
                <span class="flavoriz-filter-sort-label">
                    <i class="fi-rs-apps-sort"></i> Trier par:
                </span>
                <div class="flavoriz-filter-select">
                    <select class="sorting mySelect" id="mySelect">
                        <option value="-date" selected>Date, nouveau à ancien</option>
                        <option value="date">Date, ancien à nouveau</option>
                        <option value="PRDPrice">Prix, bas à haut</option>
                        <option value="-PRDPrice">Prix, haut à bas</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div style="max-width: 1400px; margin: 0 auto; padding: 0 var(--spacing-lg);">
        <div style="display: grid; grid-template-columns: 280px 1fr; gap: var(--spacing-xl);">
            <!-- Sidebar Categories -->
            <aside style="background: var(--color-white); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); height: fit-content; position: sticky; top: 100px;">
                <h3 style="font-size: 20px; font-weight: 700; color: var(--color-black); margin-bottom: var(--spacing-md);">Catégories</h3>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    {% for super in supercategory|slice:":10"%}
                    <li style="margin-bottom: var(--spacing-sm);">
                        <a href="{% url 'categories:super-category' super.slug%}" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-md); text-decoration: none; color: var(--text-dark); transition: all 0.2s ease; font-size: 14px;">
                            {%if super.category_image%}
                            <img src="{{super.category_image.url}}" alt="{{super.name}}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;" />
                            {%else%}
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--color-orange-light); display: flex; align-items: center; justify-content: center; color: var(--color-white); font-weight: 600; font-size: 14px;">{{super.name|first|upper}}</div>
                            {%endif%}
                            <span>{{super.name}}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                {%if supercategory.count >= 11  %}
                <div class="more_categories" style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 1px solid #E5E7EB; cursor: pointer; color: var(--color-orange); font-size: 14px; font-weight: 500;">
                    <span>Voir plus...</span>
                </div>
                <ul class="ul-category more_slide_open" style="display: none; list-style: none; padding: 0; margin: var(--spacing-sm) 0 0 0;">
                    {%for super in supercategory|slice:"10:" %}
                    <li style="margin-bottom: var(--spacing-sm);">
                        <a href="{% url 'categories:super-category' super.slug%}" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-md); text-decoration: none; color: var(--text-dark); transition: all 0.2s ease; font-size: 14px;">
                            {%if super.category_image%}
                            <img src="{{super.category_image.url}}" alt="{{super.name}}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;" />
                            {%else%}
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--color-orange-light); display: flex; align-items: center; justify-content: center; color: var(--color-white); font-weight: 600; font-size: 14px;">{{super.name|first|upper}}</div>
                            {%endif%}
                            <span>{{super.name}}</span>
                        </a>
                    </li>
                    {%endfor%}
                </ul>
                {%endif%}
            </aside>

            <!-- Products Grid -->
            <div>
                <div id="products-list" class="flavoriz-product-grid">
                    <!-- Products will be loaded here via AJAX -->
                </div>
                
                <!-- Loading Spinner -->
                <div id="spinner-box" class="not-visible" style="text-align: center; padding: var(--spacing-xl);">
                    <div class="flavoriz-spinner"></div>
                </div>
                
                <!-- Empty Box -->
                <div id="empty-box" class="not-visible" style="text-align: center; padding: var(--spacing-xl); color: var(--text-gray);">
                    <p style="font-size: 16px; font-weight: 600;">Aucun autre produit disponible !</p>
                </div>

                <!-- Load More Button -->
                <div id="loading-box" style="text-align: center; padding: var(--spacing-xl);">
                    <button id="load-btn" type="button" style="padding: 14px 32px; background: var(--color-black); color: var(--color-white); border: none; border-radius: var(--radius-full); font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease;">
                        Charger plus
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
@keyframes spin {
    to { transform: rotate(360deg); }
}

.not-visible {
    display: none !important;
}

#load-btn:hover {
    background: var(--color-orange) !important;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

@media (max-width: 1024px) {
    .flavoriz-section > div:last-child > div {
        grid-template-columns: 1fr !important;
    }
    
    aside {
        position: static !important;
        margin-bottom: var(--spacing-lg);
    }
}

@media (max-width: 768px) {
    h1 {
        font-size: 32px !important;
    }
}
</style>
{%endblock body%}

{%block script%}
<script src="{% static 'assets/js/vendor/jquery-3.6.0.min.js'%}"></script>
<script src="{% static 'assets/js/filter.js'%}"></script>
<script>
    var categoryType = "all";
    var categoryID = null;
    
    // Update product cards to use FLAVORIZ design
    function createProductCard(product) {
        const hasDiscount = product.PRDDiscountPrice > 0;
        const price = parseFloat(product.PRDPrice).toFixed(0);
        const discountPrice = product.PRDDiscountPrice ? parseFloat(product.PRDDiscountPrice).toFixed(0) : null;
        
        return `
            <div class="flavoriz-product-card" onclick="window.location.href='/product-details/${product.PRDSlug}'">
                <img src="/media/${product.product_image}" alt="${product.product_name}" class="flavoriz-product-image" />
                <div class="flavoriz-product-body">
                    <div class="flavoriz-product-views">
                        <i class="fi-rs-eye"></i>
                        <span>${product.view_count || 0}+ vues</span>
                    </div>
                    <h3 class="flavoriz-product-title">${product.product_name}</h3>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                        <span style="font-size: 20px; font-weight: 700; color: var(--color-orange);">${price} XOF</span>
                        ${discountPrice ? `<span style="font-size: 14px; color: var(--text-light); text-decoration: line-through;">${discountPrice} XOF</span>` : ''}
                    </div>
                    <button class="flavoriz-product-card-btn" onclick="event.stopPropagation(); window.location.href='/product-details/${product.PRDSlug}'">
                        <i class="fi-rs-eye"></i>
                        <span>Voir le produit</span>
                    </button>
                </div>
            </div>
        `;
    }
    
    // Override the filter.js product rendering
    $(document).ready(function() {
        // This will be handled by filter.js, but we'll update the product cards styling
        const originalAppend = $.fn.append;
        $.fn.append = function() {
            const result = originalAppend.apply(this, arguments);
            // Update any product cards that were added
            $('.product-cart-wrap').each(function() {
                $(this).addClass('flavoriz-product-card');
            });
            return result;
        };
    });
</script>
{%endblock script%}
