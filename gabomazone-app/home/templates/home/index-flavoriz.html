{% extends 'base.html' %}
{% load static %}
{% load cart_template_tags %}

{%block body%}

<!-- ===== Hero Banner Section FLAVORIZ ===== -->
<section class="flavoriz-hero-banner">
    <div class="flavoriz-hero-container">
        <!-- Hero Carousel -->
        <div class="flavoriz-hero-carousel-wrapper">
            <div class="flavoriz-hero-carousel" id="heroCarousel">
                {% if carousels %}
                    {% for carousel in carousels %}
                    <div class="flavoriz-hero-slide {% if forloop.first %}active{% endif %}">
                        <div class="flavoriz-hero-slide-content">
                            {% if carousel.CARImage %}
                            <div class="flavoriz-hero-slide-image">
                                <img src="{{carousel.CARImage.url}}" alt="{{carousel.CARtitle}}" />
                                <div class="flavoriz-hero-slide-overlay"></div>
                            </div>
                            {% endif %}
                            <div class="flavoriz-hero-slide-text">
                                <h1 class="flavoriz-hero-slide-title">
                                    {% if carousel.CARtitle %}
                                        {{carousel.CARtitle}}
                                    {% else %}
                                        Explorez <span class="flavoriz-hero-highlight">Notre Marché</span>
                                    {% endif %}
                                </h1>
                                {% if carousel.CARURL %}
                                <a href="{{carousel.CARURL}}" class="flavoriz-hero-slide-btn">
                                    Découvrir maintenant
                                    <i class="fi-rs-arrow-right"></i>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <!-- Slide par défaut -->
                    <div class="flavoriz-hero-slide active">
                        <div class="flavoriz-hero-slide-content">
                            <div class="flavoriz-hero-slide-image">
                                <div class="flavoriz-hero-placeholder-gradient"></div>
                            </div>
                            <div class="flavoriz-hero-slide-text">
                                <h1 class="flavoriz-hero-slide-title">
                                    Explorez <span class="flavoriz-hero-highlight">Notre Marché</span>
                                </h1>
                                <a href="{% url 'categories:shop' %}" class="flavoriz-hero-slide-btn">
                                    Découvrir maintenant
                                    <i class="fi-rs-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
            
            <!-- Navigation Buttons -->
            {% if carousels|length > 1 %}
            <button class="flavoriz-hero-nav-btn flavoriz-hero-prev" id="heroPrev" aria-label="Slide précédent">
                <i class="fi-rs-arrow-left"></i>
            </button>
            <button class="flavoriz-hero-nav-btn flavoriz-hero-next" id="heroNext" aria-label="Slide suivant">
                <i class="fi-rs-arrow-right"></i>
            </button>
            
            <!-- Slide Indicators -->
            <div class="flavoriz-hero-indicators">
                {% for carousel in carousels %}
                <button class="flavoriz-hero-indicator {% if forloop.first %}active{% endif %}" data-slide="{{forloop.counter0}}" aria-label="Aller au slide {{forloop.counter}}"></button>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <!-- Publicités Banners -->
        <div class="flavoriz-hero-ads">
            {% if home_ad_middlebar %}
                {% for ad in home_ad_middlebar|slice:":2" %}
                <div class="flavoriz-hero-ad-card">
                    {% if ad.ad_mage %}
                    <a href="{% if ad.ad_URL %}{{ad.ad_URL}}{% else %}#{% endif %}" class="flavoriz-hero-ad-link">
                        <img src="{{ad.ad_mage.url}}" alt="{{ad.ad_title|default:'Publicité'}}" />
                        {% if ad.ad_title %}
                        <div class="flavoriz-hero-ad-overlay">
                            <span class="flavoriz-hero-ad-title">{{ad.ad_title}}</span>
                        </div>
                        {% endif %}
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</section>

<!-- ===== Section "Que recherchez-vous?" ===== -->
<section class="flavoriz-section" style="padding: 0 var(--spacing-lg); margin-bottom: var(--spacing-2xl);">
    <h2 class="flavoriz-section-title" style="font-size: 36px; font-weight: 800; color: var(--color-black); margin-bottom: var(--spacing-md);">
        Que recherchez-vous<span style="color: var(--color-orange);"> ?</span>
    </h2>
    
    <!-- Category Tags -->
    <div class="flavoriz-category-tags">
        <a href="{% url 'categories:shop' %}" class="flavoriz-tag active">
            <i class="fi-rs-apps"></i>
            <span>Tous les types</span>
        </a>
        {% for categori in super_category|slice:":8" %}
        <a href="{% url 'categories:super-category' categori.slug%}" class="flavoriz-tag">
            {% if "électronique" in categori.name|lower or "electronique" in categori.name|lower or "tech" in categori.name|lower or "informatique" in categori.name|lower %}
                <i class="fi-rs-laptop"></i>
            {% elif "mode" in categori.name|lower or "vêtement" in categori.name|lower or "vetement" in categori.name|lower or "fashion" in categori.name|lower %}
                <i class="fi-rs-shopping-bag"></i>
            {% elif "immobilier" in categori.name|lower or "maison" in categori.name|lower or "logement" in categori.name|lower %}
                <i class="fi-rs-building"></i>
            {% elif "scolaire" in categori.name|lower or "fourniture" in categori.name|lower or "livre" in categori.name|lower or "papeterie" in categori.name|lower %}
                <i class="fi-rs-book"></i>
            {% elif "loisir" in categori.name|lower or "sport" in categori.name|lower or "jeu" in categori.name|lower or "musique" in categori.name|lower %}
                <i class="fi-rs-heart"></i>
            {% elif "service" in categori.name|lower or "autre" in categori.name|lower or "divers" in categori.name|lower %}
                <i class="fi-rs-briefcase"></i>
            {% else %}
                <i class="fi-rs-apps"></i>
            {% endif %}
            <span>{{categori.name}}</span>
        </a>
        {% endfor %}
    </div>
</section>

<!-- ===== Carrousel Produits Populaires ===== -->
<section class="flavoriz-section" style="padding: var(--spacing-xl) var(--spacing-lg); margin-bottom: var(--spacing-2xl); background: linear-gradient(135deg, #FDF8F3 0%, #FFF9F5 100%);">
    <div style="max-width: 1400px; margin: 0 auto;">
        <!-- Section Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); flex-wrap: wrap; gap: 16px;">
            <div>
                <h2 style="font-size: 32px; font-weight: 700; color: var(--color-black); margin: 0 0 6px 0; font-family: var(--font-primary);">
                    <i class="fi-rs-star" style="color: var(--color-orange); margin-right: 8px;"></i>
                    Articles les plus populaires
                </h2>
                <p style="font-size: 14px; color: #6B7280; margin: 0;">Découvrez nos produits les plus appréciés</p>
            </div>
            <a href="{% url 'categories:shop' %}?order_by=-like_count" style="padding: 12px 24px; background: var(--color-orange); color: white; border-radius: 10px; font-weight: 600; font-size: 14px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 123, 44, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(255, 123, 44, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(255, 123, 44, 0.3)'">
                <span>Voir plus</span>
                <i class="fi-rs-arrow-right"></i>
            </a>
        </div>
        
        <!-- Carrousel Container -->
        <div class="carousel-container" style="position: relative;">
            <div class="carousel-wrapper" style="position: relative;">
                <div id="popular-carousel" class="carousel-track" style="display: flex; gap: 20px; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);">
                    {% for item in popular_products_data %}
                    {% with product=item.product product_images=item.product_images like_count=item.like_count %}
                    {% with price=product.PRDPrice discount_price=product.PRDDiscountPrice %}
                    <div class="flavoriz-product-card carousel-item" style="cursor: pointer; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: none; display: flex; flex-direction: column; height: 100%;">
                        <div style="position: relative; overflow: hidden; background: #FAFAFA; width: 100%; padding-top: 65%;">
                            <img src="/media/{{ product.product_image }}" alt="{{ product.product_name }}" class="flavoriz-product-image" data-images='{{ product_images|safe }}' onclick="event.stopPropagation(); openImagePreview(JSON.parse(this.getAttribute('data-images')), 0, '{{ product.product_name|escapejs }}');" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; cursor: zoom-in;" />
                            <button class="flavoriz-favorite-btn" data-product-id="{{ product.id }}" type="button" style="position: absolute; top: 8px; right: 8px; background: rgba(255, 255, 255, 0.95); border: none; border-radius: 16px; padding: 6px 10px; display: flex; align-items: center; gap: 4px; font-size: 10px; color: #6B7280; font-weight: 600; backdrop-filter: blur(4px); box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); cursor: pointer; transition: all 0.3s ease; z-index: 10;">
                                <i class="fi-rs-heart" style="font-size: 12px; transition: all 0.3s ease;"></i>
                                <span class="favorite-count">{{ like_count }}</span>
                            </button>
                        </div>
                        <div class="flavoriz-product-body" style="padding: 14px; flex: 1; display: flex; flex-direction: column;">
                            <h3 class="flavoriz-product-title" onclick="window.location.href='{% url 'products:product-details' product.PRDSlug %}'" style="font-size: 14px; font-weight: 600; color: #1F2937; margin: 0 0 10px 0; line-height: 1.4; min-height: 40px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex-shrink: 0; cursor: pointer;">{{ product.product_name }}</h3>
                            <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; flex-shrink: 0;">
                                <span style="font-size: 18px; font-weight: 700; color: var(--color-orange);">{{ price|format_price }} FCFA</span>
                                {% if discount_price and discount_price > 0 %}
                                    <span style="font-size: 13px; color: #9CA3AF; text-decoration: line-through;">{{ discount_price|format_price }} FCFA</span>
                                {% endif %}
                            </div>
                            <div style="display: flex; gap: 8px; margin-top: auto;">
                                <button class="flavoriz-product-card-btn" onclick="event.stopPropagation(); window.location.href='{% url 'products:product-details' product.PRDSlug %}'" style="flex: 1; padding: 10px 16px; background: #1F2937; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
                                    <i class="fi-rs-eye" style="font-size: 13px;"></i>
                                    <span>Voir</span>
                                </button>
                                <button class="flavoriz-add-cart-btn" data-product-id="{{ product.id }}" data-product-price="{{ price|floatformat:0 }}" type="button" style="padding: 10px 14px; background: white; color: #1F2937; border: 1px solid #1F2937; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); min-width: 48px;">
                                    <i class="fi-rs-shopping-bag" style="font-size: 15px;"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                    {% endwith %}
                    {% endfor %}
                </div>
            </div>
            <!-- Navigation Buttons -->
            <button class="carousel-btn carousel-prev" id="popular-prev" style="position: absolute; left: -20px; top: 50%; transform: translateY(-50%); background: white; border: 2px solid #E5E7EB; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); z-index: 10;" onmouseover="this.style.borderColor='var(--color-orange)'; this.style.color='var(--color-orange)'; this.style.transform='translateY(-50%) scale(1.1)'" onmouseout="this.style.borderColor='#E5E7EB'; this.style.color='#1F2937'; this.style.transform='translateY(-50%) scale(1)'">
                <i class="fi-rs-arrow-left" style="font-size: 20px; color: #1F2937;"></i>
            </button>
            <button class="carousel-btn carousel-next" id="popular-next" style="position: absolute; right: -20px; top: 50%; transform: translateY(-50%); background: white; border: 2px solid #E5E7EB; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); z-index: 10;" onmouseover="this.style.borderColor='var(--color-orange)'; this.style.color='var(--color-orange)'; this.style.transform='translateY(-50%) scale(1.1)'" onmouseout="this.style.borderColor='#E5E7EB'; this.style.color='#1F2937'; this.style.transform='translateY(-50%) scale(1)'">
                <i class="fi-rs-arrow-right" style="font-size: 20px; color: #1F2937;"></i>
            </button>
        </div>
    </div>
</section>

<!-- ===== Carrousel Nouveaux Produits ===== -->
<section class="flavoriz-section" style="padding: var(--spacing-xl) var(--spacing-lg); margin-bottom: var(--spacing-2xl); background: linear-gradient(135deg, #FDF8F3 0%, #FFF9F5 100%);">
    <div style="max-width: 1400px; margin: 0 auto;">
        <!-- Section Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); flex-wrap: wrap; gap: 16px;">
            <div>
                <h2 style="font-size: 32px; font-weight: 700; color: var(--color-black); margin: 0 0 6px 0; font-family: var(--font-primary);">
                    <i class="fi-rs-sparkles" style="color: var(--color-orange); margin-right: 8px;"></i>
                    Nouveaux articles
                </h2>
                <p style="font-size: 14px; color: #6B7280; margin: 0;">Découvrez nos dernières nouveautés</p>
            </div>
            <a href="{% url 'categories:shop' %}?order_by=-date" style="padding: 12px 24px; background: var(--color-orange); color: white; border-radius: 10px; font-weight: 600; font-size: 14px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 123, 44, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(255, 123, 44, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(255, 123, 44, 0.3)'">
                <span>Voir plus</span>
                <i class="fi-rs-arrow-right"></i>
            </a>
        </div>
        
        <!-- Carrousel Container -->
        <div class="carousel-container" style="position: relative;">
            <div class="carousel-wrapper" style="position: relative;">
                <div id="new-carousel" class="carousel-track" style="display: flex; gap: 20px; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);">
                    {% for item in new_products_data %}
                    {% with product=item.product product_images=item.product_images like_count=item.like_count %}
                    {% with price=product.PRDPrice discount_price=product.PRDDiscountPrice %}
                    <div class="flavoriz-product-card carousel-item" style="cursor: pointer; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: none; display: flex; flex-direction: column; height: 100%;">
                        <div style="position: relative; overflow: hidden; background: #FAFAFA; width: 100%; padding-top: 65%;">
                            <img src="/media/{{ product.product_image }}" alt="{{ product.product_name }}" class="flavoriz-product-image" data-images='{{ product_images|safe }}' onclick="event.stopPropagation(); openImagePreview(JSON.parse(this.getAttribute('data-images')), 0, '{{ product.product_name|escapejs }}');" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; cursor: zoom-in;" />
                            <button class="flavoriz-favorite-btn" data-product-id="{{ product.id }}" type="button" style="position: absolute; top: 8px; right: 8px; background: rgba(255, 255, 255, 0.95); border: none; border-radius: 16px; padding: 6px 10px; display: flex; align-items: center; gap: 4px; font-size: 10px; color: #6B7280; font-weight: 600; backdrop-filter: blur(4px); box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); cursor: pointer; transition: all 0.3s ease; z-index: 10;">
                                <i class="fi-rs-heart" style="font-size: 12px; transition: all 0.3s ease;"></i>
                                <span class="favorite-count">{{ like_count }}</span>
                            </button>
                        </div>
                        <div class="flavoriz-product-body" style="padding: 14px; flex: 1; display: flex; flex-direction: column;">
                            <h3 class="flavoriz-product-title" onclick="window.location.href='{% url 'products:product-details' product.PRDSlug %}'" style="font-size: 14px; font-weight: 600; color: #1F2937; margin: 0 0 10px 0; line-height: 1.4; min-height: 40px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex-shrink: 0; cursor: pointer;">{{ product.product_name }}</h3>
                            <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; flex-shrink: 0;">
                                <span style="font-size: 18px; font-weight: 700; color: var(--color-orange);">{{ price|format_price }} FCFA</span>
                                {% if discount_price and discount_price > 0 %}
                                    <span style="font-size: 13px; color: #9CA3AF; text-decoration: line-through;">{{ discount_price|format_price }} FCFA</span>
                                {% endif %}
                            </div>
                            <div style="display: flex; gap: 8px; margin-top: auto;">
                                <button class="flavoriz-product-card-btn" onclick="event.stopPropagation(); window.location.href='{% url 'products:product-details' product.PRDSlug %}'" style="flex: 1; padding: 10px 16px; background: #1F2937; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
                                    <i class="fi-rs-eye" style="font-size: 13px;"></i>
                                    <span>Voir</span>
                                </button>
                                <button class="flavoriz-add-cart-btn" data-product-id="{{ product.id }}" data-product-price="{{ price|floatformat:0 }}" type="button" style="padding: 10px 14px; background: white; color: #1F2937; border: 1px solid #1F2937; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); min-width: 48px;">
                                    <i class="fi-rs-shopping-bag" style="font-size: 15px;"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                    {% endwith %}
                    {% endfor %}
                </div>
            </div>
            <!-- Navigation Buttons -->
            <button class="carousel-btn carousel-prev" id="new-prev" style="position: absolute; left: -20px; top: 50%; transform: translateY(-50%); background: white; border: 2px solid #E5E7EB; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); z-index: 10;" onmouseover="this.style.borderColor='var(--color-orange)'; this.style.color='var(--color-orange)'; this.style.transform='translateY(-50%) scale(1.1)'" onmouseout="this.style.borderColor='#E5E7EB'; this.style.color='#1F2937'; this.style.transform='translateY(-50%) scale(1)'">
                <i class="fi-rs-arrow-left" style="font-size: 20px; color: #1F2937;"></i>
            </button>
            <button class="carousel-btn carousel-next" id="new-next" style="position: absolute; right: -20px; top: 50%; transform: translateY(-50%); background: white; border: 2px solid #E5E7EB; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); z-index: 10;" onmouseover="this.style.borderColor='var(--color-orange)'; this.style.color='var(--color-orange)'; this.style.transform='translateY(-50%) scale(1.1)'" onmouseout="this.style.borderColor='#E5E7EB'; this.style.color='#1F2937'; this.style.transform='translateY(-50%) scale(1)'">
                <i class="fi-rs-arrow-right" style="font-size: 20px; color: #1F2937;"></i>
            </button>
        </div>
    </div>
</section>

<!-- ===== Newsletter Section ===== -->
<section class="flavoriz-newsletter" style="padding: var(--spacing-xl) var(--spacing-lg); margin: var(--spacing-2xl) auto;">
    <div class="flavoriz-newsletter-logo" style="font-size: 32px; margin-bottom: var(--spacing-sm);">{{site_info.site_name}}</div>
    <p class="flavoriz-newsletter-text" style="font-size: 14px; margin-bottom: var(--spacing-md);">
        Rejoignez {{site_info.site_name}} maintenant et découvrez une expérience d'achat exceptionnelle avec des produits de qualité et des prix compétitifs !
    </p>
    <form method="POST" class="flavoriz-newsletter-form">
        {% csrf_token %}
        <input type="email" name="email" class="flavoriz-newsletter-input" placeholder="Entrez votre adresse e-mail..." required style="padding: 14px 18px; font-size: 13px;" />
        <button type="submit" class="flavoriz-newsletter-btn" style="padding: 14px 28px; font-size: 13px;">S'abonner</button>
    </form>
</section>

<!-- Footer est maintenant dans base.html pour toutes les pages -->

<style>
/* ===== Hero Banner Styles - Moderne et Élégant ===== */
.flavoriz-hero-banner {
    width: 100vw;
    max-width: 100%;
    margin: 0 0 40px 0;
    padding: 0;
    position: relative;
    overflow: hidden;
    margin-left: calc(-50vw + 50%);
    margin-right: calc(-50vw + 50%);
}

.flavoriz-hero-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    width: 100%;
    box-sizing: border-box;
}

.flavoriz-hero-carousel-wrapper {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    background: white;
    height: 500px;
    width: 100%;
}

.flavoriz-hero-carousel {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.flavoriz-hero-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateX(100%);
}

.flavoriz-hero-slide.active {
    opacity: 1;
    transform: translateX(0);
    z-index: 1;
}

.flavoriz-hero-slide.prev {
    transform: translateX(-100%);
}

.flavoriz-hero-slide-content {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.flavoriz-hero-slide-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
}

.flavoriz-hero-slide-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 10s ease-out;
}

.flavoriz-hero-slide.active .flavoriz-hero-slide-image img {
    transform: scale(1.1);
}

.flavoriz-hero-slide-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 50%, rgba(0, 0, 0, 0.5) 100%);
    z-index: 1;
}

.flavoriz-hero-slide-text {
    position: relative;
    z-index: 2;
    text-align: center;
    padding: 40px;
    max-width: 700px;
    color: white;
}

.flavoriz-hero-slide-title {
    font-size: 48px;
    font-weight: 800;
    line-height: 1.2;
    margin: 0 0 24px 0;
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    animation: slideInUp 0.8s ease-out;
}

.flavoriz-hero-slide-title .flavoriz-hero-highlight {
    color: var(--color-orange);
    display: inline-block;
    position: relative;
}

.flavoriz-hero-slide-btn {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 16px 32px;
    background: var(--color-orange);
    color: white;
    border-radius: 12px;
    font-weight: 600;
    font-size: 16px;
    text-decoration: none;
    box-shadow: 0 8px 24px rgba(255, 123, 44, 0.4);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: slideInUp 0.8s ease-out 0.2s both;
}

.flavoriz-hero-slide-btn:hover {
    background: #E65A1F;
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(255, 123, 44, 0.5);
}

.flavoriz-hero-slide-btn i {
    font-size: 18px;
    transition: transform 0.3s ease;
}

.flavoriz-hero-slide-btn:hover i {
    transform: translateX(4px);
}

.flavoriz-hero-placeholder-gradient {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--color-orange) 0%, #E65A1F 50%, var(--color-orange) 100%);
    background-size: 200% 200%;
    animation: gradientShift 8s ease infinite;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Navigation Buttons */
.flavoriz-hero-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 56px;
    height: 56px;
    background: rgba(255, 255, 255, 0.95);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    color: #1F2937;
}

.flavoriz-hero-nav-btn:hover {
    background: white;
    border-color: var(--color-orange);
    color: var(--color-orange);
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 6px 24px rgba(255, 123, 44, 0.3);
}

.flavoriz-hero-nav-btn i {
    font-size: 24px;
}

.flavoriz-hero-prev {
    left: 20px;
}

.flavoriz-hero-next {
    right: 20px;
}

/* Indicators */
.flavoriz-hero-indicators {
    position: absolute;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 10;
}

.flavoriz-hero-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.5);
    background: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0;
}

.flavoriz-hero-indicator.active {
    background: var(--color-orange);
    border-color: var(--color-orange);
    width: 32px;
    border-radius: 6px;
}

.flavoriz-hero-indicator:hover {
    background: rgba(255, 255, 255, 0.3);
    border-color: white;
}

/* Publicités Banners */
.flavoriz-hero-ads {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.flavoriz-hero-ad-card {
    flex: 1;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    background: white;
}

.flavoriz-hero-ad-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

.flavoriz-hero-ad-link {
    display: block;
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 242px;
    overflow: hidden;
}

.flavoriz-hero-ad-link img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.flavoriz-hero-ad-card:hover .flavoriz-hero-ad-link img {
    transform: scale(1.05);
}

.flavoriz-hero-ad-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 100%);
    padding: 20px;
    color: white;
}

.flavoriz-hero-ad-title {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

/* Responsive */
@media (max-width: 1024px) {
    .flavoriz-hero-container {
        grid-template-columns: 1fr;
        padding: 0 16px;
    }
    
    .flavoriz-hero-ads {
        flex-direction: row;
    }
    
    .flavoriz-hero-ad-link {
        min-height: 200px;
    }
}

@media (max-width: 768px) {
    .flavoriz-hero-banner {
        margin: 0 auto 32px;
    }
    
    .flavoriz-hero-container {
        padding: 0 16px;
    }
    
    .flavoriz-hero-carousel-wrapper {
        height: 400px;
        border-radius: 16px;
    }
    
    .flavoriz-hero-slide-title {
        font-size: 32px;
        margin-bottom: 20px;
    }
    
    .flavoriz-hero-slide-btn {
        padding: 14px 28px;
        font-size: 14px;
    }
    
    .flavoriz-hero-nav-btn {
        width: 44px;
        height: 44px;
    }
    
    .flavoriz-hero-nav-btn i {
        font-size: 20px;
    }
    
    .flavoriz-hero-prev {
        left: 12px;
    }
    
    .flavoriz-hero-next {
        right: 12px;
    }
    
    .flavoriz-hero-indicators {
        bottom: 16px;
        gap: 8px;
    }
    
    .flavoriz-hero-indicator {
        width: 8px;
        height: 8px;
    }
    
    .flavoriz-hero-indicator.active {
        width: 24px;
    }
    
    .flavoriz-hero-ads {
        flex-direction: column;
    }
    
    .flavoriz-hero-ad-link {
        min-height: 180px;
    }
}

/* Styles pour les carrousels */
.carousel-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0 60px;
}

    .carousel-wrapper {
        width: 100%;
        overflow: hidden;
    }
    
    @media (max-width: 768px) {
        .carousel-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .carousel-wrapper::-webkit-scrollbar {
            display: none;
        }
    }

.carousel-track {
    display: flex !important;
    gap: 20px !important;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.carousel-item {
    flex: 0 0 calc(25% - 15px) !important;
    min-width: 0 !important;
    max-width: calc(25% - 15px) !important;
}

/* Masquer les boutons de navigation sur mobile */
@media (max-width: 768px) {
    /* Section principale */
    .flavoriz-section {
        padding: var(--spacing-md) 16px !important;
        margin-bottom: var(--spacing-lg) !important;
    }
    
    /* Titre de section */
    .flavoriz-section-title {
        font-size: 24px !important;
        margin-bottom: var(--spacing-sm) !important;
    }
    
    /* En-tête des carrousels */
    .flavoriz-section > div > div:first-child {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 12px !important;
        margin-bottom: var(--spacing-md) !important;
    }
    
    .flavoriz-section > div > div:first-child h2 {
        font-size: 22px !important;
        margin-bottom: 4px !important;
    }
    
    .flavoriz-section > div > div:first-child p {
        font-size: 12px !important;
    }
    
    .flavoriz-section > div > div:first-child a {
        width: 100% !important;
        justify-content: center !important;
        padding: 10px 20px !important;
        font-size: 13px !important;
    }
    
    /* Container carrousel */
    .carousel-container {
        padding: 0 8px !important;
    }
    
    .carousel-btn {
        display: none !important;
    }
    
    .carousel-track {
        gap: 12px !important;
        overflow-x: auto !important;
        scroll-snap-type: x mandatory !important;
        -webkit-overflow-scrolling: touch !important;
        scrollbar-width: none !important;
        -ms-overflow-style: none !important;
    }
    
    .carousel-track::-webkit-scrollbar {
        display: none !important;
    }
    
    .carousel-item {
        flex: 0 0 calc(50% - 6px) !important;
        max-width: calc(50% - 6px) !important;
        width: calc(50% - 6px) !important;
        scroll-snap-align: start !important;
    }
    
    /* Cartes produits sur mobile */
    .carousel-item.flavoriz-product-card {
        border-radius: 10px !important;
    }
    
    .carousel-item .flavoriz-product-body {
        padding: 10px !important;
    }
    
    .carousel-item .flavoriz-product-title {
        font-size: 13px !important;
        min-height: 36px !important;
        margin-bottom: 8px !important;
    }
    
    .carousel-item .flavoriz-product-card-btn,
    .carousel-item .flavoriz-add-cart-btn {
        padding: 8px 12px !important;
        font-size: 12px !important;
        border-radius: 6px !important;
    }
    
    .carousel-item .flavoriz-favorite-btn {
        padding: 4px 8px !important;
        font-size: 9px !important;
        border-radius: 12px !important;
    }
    
    .carousel-item .flavoriz-favorite-btn i {
        font-size: 11px !important;
    }
    
    /* Prix sur mobile */
    .carousel-item .flavoriz-product-body > div:first-of-type span:first-child {
        font-size: 16px !important;
    }
    
    /* Tags de catégories */
    .flavoriz-category-tags {
        gap: 8px !important;
        flex-wrap: wrap !important;
    }
    
    .flavoriz-tag {
        padding: 8px 12px !important;
        font-size: 12px !important;
        border-radius: 8px !important;
    }
    
    .flavoriz-tag i {
        font-size: 14px !important;
    }
    
    /* Hero section sur mobile */
    .flavoriz-hero {
        padding: var(--spacing-md) 16px !important;
        margin-bottom: var(--spacing-lg) !important;
    }
    
    .flavoriz-hero-title {
        font-size: 28px !important;
    }
    
    /* Section "Que recherchez-vous?" */
    section.flavoriz-section:first-of-type {
        padding: var(--spacing-md) 16px !important;
        margin-bottom: var(--spacing-lg) !important;
    }
    
    /* Newsletter section */
    .flavoriz-newsletter {
        padding: var(--spacing-lg) 16px !important;
        margin: var(--spacing-lg) auto !important;
    }
    
    .flavoriz-newsletter-logo {
        font-size: 24px !important;
    }
    
    .flavoriz-newsletter-form {
        flex-direction: column !important;
        gap: 12px !important;
    }
    
    .flavoriz-newsletter-input,
    .flavoriz-newsletter-btn {
        width: 100% !important;
    }
    
    /* Footer sur mobile */
    .flavoriz-footer {
        padding: var(--spacing-lg) 16px !important;
    }
    
    .flavoriz-footer-content {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: var(--spacing-md) !important;
    }
}

/* Responsive pour tablette */
@media (min-width: 769px) and (max-width: 1199px) {
    .carousel-item {
        flex: 0 0 calc(33.333% - 12px) !important;
        max-width: calc(33.333% - 12px) !important;
        width: calc(33.333% - 12px) !important;
    }
}

/* Styles pour les cartes produits dans les carrousels - Identique à la page shop */
.carousel-item.flavoriz-product-card {
    background: white !important;
    border-radius: 12px !important;
    overflow: hidden !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    border: 1px solid #F3F4F6 !important;
    cursor: pointer !important;
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
}

.carousel-item.flavoriz-product-card:hover {
    transform: translateY(-4px) !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12) !important;
    border-color: rgba(255, 123, 44, 0.3) !important;
}

.carousel-item.flavoriz-product-card:hover .flavoriz-product-image {
    transform: scale(1.05) !important;
}
</style>

<script>
(function() {
    'use strict';
    
    // ===== Hero Carousel =====
    function initHeroCarousel() {
        const carousel = document.getElementById('heroCarousel');
        const prevBtn = document.getElementById('heroPrev');
        const nextBtn = document.getElementById('heroNext');
        const indicators = document.querySelectorAll('.flavoriz-hero-indicator');
        const slides = document.querySelectorAll('.flavoriz-hero-slide');
        
        if (!carousel || slides.length <= 1) return;
        
        let currentSlide = 0;
        let autoPlayInterval;
        const autoPlayDelay = 5000; // 5 secondes
        
        function showSlide(index) {
            // Retirer la classe active de tous les slides
            slides.forEach((slide, i) => {
                slide.classList.remove('active', 'prev');
                if (i < index) {
                    slide.classList.add('prev');
                }
            });
            
            // Ajouter la classe active au slide actuel
            slides[index].classList.add('active');
            
            // Mettre à jour les indicateurs
            indicators.forEach((indicator, i) => {
                indicator.classList.toggle('active', i === index);
            });
            
            currentSlide = index;
        }
        
        function nextSlide() {
            const next = (currentSlide + 1) % slides.length;
            showSlide(next);
        }
        
        function prevSlide() {
            const prev = (currentSlide - 1 + slides.length) % slides.length;
            showSlide(prev);
        }
        
        function startAutoPlay() {
            autoPlayInterval = setInterval(nextSlide, autoPlayDelay);
        }
        
        function stopAutoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
            }
        }
        
        // Event listeners pour les boutons
        if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                nextSlide();
                stopAutoPlay();
                startAutoPlay();
            });
        }
        
        if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                prevSlide();
                stopAutoPlay();
                startAutoPlay();
            });
        }
        
        // Event listeners pour les indicateurs
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                showSlide(index);
                stopAutoPlay();
                startAutoPlay();
            });
        });
        
        // Pause au survol
        carousel.addEventListener('mouseenter', stopAutoPlay);
        carousel.addEventListener('mouseleave', startAutoPlay);
        
        // Démarrer l'auto-play
        startAutoPlay();
        
        // Gérer le swipe sur mobile
        let touchStartX = 0;
        let touchEndX = 0;
        
        carousel.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        carousel.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    nextSlide();
                } else {
                    prevSlide();
                }
                stopAutoPlay();
                startAutoPlay();
            }
        }
    }
    
    // Initialiser le carrousel hero
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initHeroCarousel);
    } else {
        initHeroCarousel();
    }
    
    // Initialiser les event listeners pour les produits
    if (typeof window.attachProductEventListeners === 'function') {
        window.attachProductEventListeners();
    }
    
    // Fonction pour gérer le carrousel
    function initCarousel(carouselId, prevBtnId, nextBtnId) {
        const carousel = document.getElementById(carouselId);
        const prevBtn = document.getElementById(prevBtnId);
        const nextBtn = document.getElementById(nextBtnId);
        
        if (!carousel || !prevBtn || !nextBtn) return;
        
        const items = carousel.querySelectorAll('.carousel-item');
        if (items.length === 0) return;
        
        let currentIndex = 0;
        
        function getItemsPerView() {
            if (window.innerWidth >= 1200) return 4;
            if (window.innerWidth >= 769) return 3;
            return 2; // 2 items sur mobile
        }
        
        // Sur mobile, permettre le scroll horizontal natif
        if (window.innerWidth <= 768) {
            carousel.style.overflowX = 'auto';
            carousel.style.scrollSnapType = 'x mandatory';
            carousel.style.webkitOverflowScrolling = 'touch';
            // Désactiver les boutons de navigation sur mobile
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
        }
        
        function updateCarousel() {
            const itemsPerView = getItemsPerView();
            const maxIndex = Math.max(0, items.length - itemsPerView);
            
            if (currentIndex > maxIndex) {
                currentIndex = maxIndex;
            }
            
            // Calculer la largeur d'un item (en incluant le gap)
            const firstItem = items[0];
            if (!firstItem) return;
            
            // Obtenir la largeur réelle de l'item
            const itemWidth = firstItem.getBoundingClientRect().width;
            const gap = 20; // gap entre les items
            const translateX = -currentIndex * (itemWidth + gap);
            
            carousel.style.transform = `translateX(${translateX}px)`;
            
            // Gérer la visibilité des boutons
            prevBtn.style.opacity = currentIndex > 0 ? '1' : '0.5';
            prevBtn.style.pointerEvents = currentIndex > 0 ? 'auto' : 'none';
            prevBtn.style.cursor = currentIndex > 0 ? 'pointer' : 'not-allowed';
            nextBtn.style.opacity = currentIndex < maxIndex ? '1' : '0.5';
            nextBtn.style.pointerEvents = currentIndex < maxIndex ? 'auto' : 'none';
            nextBtn.style.cursor = currentIndex < maxIndex ? 'pointer' : 'not-allowed';
        }
        
        prevBtn.addEventListener('click', function() {
            if (currentIndex > 0) {
                currentIndex--;
                updateCarousel();
            }
        });
        
        nextBtn.addEventListener('click', function() {
            const itemsPerView = getItemsPerView();
            const maxIndex = Math.max(0, items.length - itemsPerView);
            if (currentIndex < maxIndex) {
                currentIndex++;
                updateCarousel();
            }
        });
        
        // Gérer le redimensionnement
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                currentIndex = 0;
                // Sur mobile, désactiver les boutons et activer le scroll natif
                if (window.innerWidth <= 768) {
                    prevBtn.style.display = 'none';
                    nextBtn.style.display = 'none';
                    carousel.style.overflowX = 'auto';
                    carousel.style.scrollSnapType = 'x mandatory';
                    carousel.style.webkitOverflowScrolling = 'touch';
                } else {
                    prevBtn.style.display = 'flex';
                    nextBtn.style.display = 'flex';
                    carousel.style.overflowX = 'hidden';
                    carousel.style.scrollSnapType = 'none';
                }
                updateCarousel();
            }, 250);
        });
        
        // Sur mobile, désactiver les boutons et activer le scroll natif dès le début
        if (window.innerWidth <= 768) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            carousel.style.overflowX = 'auto';
            carousel.style.scrollSnapType = 'x mandatory';
            carousel.style.webkitOverflowScrolling = 'touch';
        }
        
        // Initialiser après un court délai pour s'assurer que les éléments sont rendus
        setTimeout(updateCarousel, 100);
    }
    
    // Initialiser les deux carrousels
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            initCarousel('popular-carousel', 'popular-prev', 'popular-next');
            initCarousel('new-carousel', 'new-prev', 'new-next');
        });
    } else {
        initCarousel('popular-carousel', 'popular-prev', 'popular-next');
        initCarousel('new-carousel', 'new-prev', 'new-next');
    }
})();
</script>

{% endblock %}
